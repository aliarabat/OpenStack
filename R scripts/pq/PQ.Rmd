---
title: "PQ"
author: "Ali Arabat"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library("scales")
library(ggplot2)
```

```{r}
PQ_URL = "/Users/aliarabat/Documents/PhD/projects/openstack-evolution/RQs/PQ/Files/"
all_developers <- read.csv(paste(PQ_URL, "developers.csv", sep=""))
core_non_core_changes <- read.csv(paste(PQ_URL, "core_non_core_changes.csv", sep=""))
core_non_core_reviewers_changes <- read.csv(paste(PQ_URL, "core_non_core_reviewers_changes.csv", sep=""))
dev_with_team <- read.csv(paste(PQ_URL, "dev_with_team.csv", sep=""))
rev_with_team <- read.csv(paste(PQ_URL, "rev_with_team.csv", sep=""))

inter_team_dev <- read.csv(paste(PQ_URL, "inter_team_dev.csv", sep=""))
inter_team_rev <- read.csv(paste(PQ_URL, "inter_team_rev.csv", sep=""))
dev_rev_pro <- read.csv(paste(PQ_URL, "dev_rev_pro.csv", sep=""))
dev_rev_team <- read.csv(paste(PQ_URL, "dev_rev_team.csv", sep=""))
```


```{r}
give.n <- function(x){
  return(c(y = median(x)*1.05, label = length(x))) 
  # experiment with the multiplier to find the perfect position
}
```


```{r}
p0 <-all_developers %>%
  ggplot(aes(x = factor(0), y = changes), outlier.shape = NA) + 
  geom_boxplot(fatten=.5) + 
  scale_y_continuous(trans = "log1p", breaks = c(0,1,10, 100, 1000))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "none",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.title = element_text(size = 10)
  )+
  labs(x = "", y = "# of changes") +
  scale_x_discrete(breaks = NULL)
p0
```


```{r}
p1<-core_non_core_changes %>%
  # mutate(nbr_changes = log1p(nbr_changes))%>%
ggplot() +
  geom_boxplot(aes(x=status, y=changes, fill=status), fatten=.5, outlier.shape = NA)+
  scale_y_continuous(trans = "log1p", breaks = c(0,1,10, 100, 1000))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "none",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.title = element_text(size = 10)
  )+
  stat_summary(fun.data = give.n, aes(x=status, y=changes),vjust = -3, size=3.5, geom = "text", fun = "median", 
                   position = position_dodge(width = 0.75))+
  # theme(legend.title=element_blank())+
  labs(x = "Developers", y = "# of changes", fill = "Developer")
p1
```


```{r}
p2<-core_non_core_reviewers_changes%>%
  # mutate(count = log1p(count))%>%
ggplot() +
  geom_boxplot(aes(x=status, y=changes, fill=status), fatten=.5, outlier.shape = NA)+
  scale_y_continuous(trans = "log1p", breaks = c(0,1,10, 100, 1000, 10000))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "none",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.title = element_text(size = 10)
  )+
  stat_summary(fun.data = give.n, aes(x=status, y=changes),vjust = -3, size=3.5, geom = "text", fun = "median", 
                   position = position_dodge(width = 0.75))+
  # guides(size = 5)+
  # theme(legend.title=element_blank())+
  labs(x = "Reviewers", y = "# of changes", fill = "Developer")
p2
```

```{r}
p3<-dev_with_team%>%
  # mutate(service = log1p(service))%>%
ggplot() +
  geom_boxplot(aes(x=team, y=intersection), fatten=0.4, outlier.shape = NA)+
  # scale_y_continuous(trans = "log1p", breaks = c(1, 5, 15, 25, 45))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "top",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
    axis.title = element_text(size = 12)
  )+
  labs(x = "Services", y = "Developers intersection")+
   scale_y_continuous(labels=c('0%', '25%', '50%', '75%', '100%'))
p3
```


```{r}
p4<-rev_with_team%>%
  # mutate(service = log1p(service))%>%
ggplot() +
  geom_boxplot(aes(x=team, y=intersection, fill=status), fatten=0.4, outlier.shape = NA)+
  # scale_y_continuous(trans = "log1p", breaks = c(1, 5, 15, 25, 45))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "top",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
    axis.title = element_text(size = 12)
  )+
  labs(x = "Teams", y = "Reviewers intersection", fill = "Reviewer")+
   scale_y_continuous(labels=c('0%', '25%', '50%', '75%', '100%'))
p4
```

```{r}
plot_boxplot <- function(data, individual, labels){
  result = data%>%
  ggplot() +
  geom_boxplot(aes(x=status, y=intersection, fill=status), fatten=0.4)+
  # scale_y_continuous( breaks = c(1, 5, 15, 25, 45))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "top",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.title = element_text(size = 12)
  )+
  labs(x = individual, y = paste(individual, "s intersection", sep = ""), fill = individual)+
   scale_y_continuous(labels=labels)
  return(result)
}
```


```{r}
p5<-plot_boxplot(inter_team_dev, 'Developer', c('0%', '25%', '50%', '75%', '100%'))
p5
```

```{r}
p6<-plot_boxplot(inter_team_rev, 'Reviewer', c('0%', '20%', '40%', '60%'))
p6
```


```{r}
p7<-dev_rev_pro%>%
  # mutate(projects_nbr = log1p(projects_nbr))%>%
ggplot() +
  geom_boxplot(aes(x=individual, y=project, fill=status), fatten=0.5, outlier.shape = NA)+
  scale_y_continuous(trans = "log1p", breaks = c(0,1,10, 100, 1000))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "top",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.title = element_text(size = 10)
  )+
   # stat_summary(fun.data = give.n, aes(x=dev_status, y=projects_nbr),vjust = -3.5, size=3.5, geom = "text", fun = "median",
   #                 position = position_dodge(width = 0.75))+
  # theme(legend.title=element_blank())+
  labs(x = "Individual", y = "# of projects", fill = "Individual")
p7
```

```{r}
p8<-dev_rev_team%>%
  # mutate(projects_nbr = log1p(projects_nbr))%>%
ggplot() +
  geom_boxplot(aes(x=individual, y=team, fill=status), fatten=0.5, outlier.shape = NA)+
  scale_y_continuous(trans = "log1p", breaks = c(0,1,10, 100, 1000))+
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "top",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.title = element_text(size = 10)
  )+
   # stat_summary(fun.data = give.n, aes(x=dev_status, y=projects_nbr),vjust = -3.5, size=3.5, geom = "text", fun = "median",
   #                 position = position_dodge(width = 0.75))+
  # theme(legend.title=element_blank())+
  labs(x = "Individual", y = "# of teams", fill = "Individual")
p8
```


```{r}
p3_1 <- projects_metrics[projects_metrics$intersect_dev>0,] %>%
  ggplot(aes(x = factor(0), y = intersect_dev)) + 
   scale_y_continuous(trans = "log1p", breaks = c(0,1,10, 100, 1000))+
  geom_boxplot() + 
  theme_linedraw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "top",
    axis.line = element_line(colour = "black"),
    axis.text = element_text(size = 9, color = "grey30"),
    axis.title = element_text(size = 10)
  )+
  labs(x = "", y = "Developers' intersection") +
  scale_x_discrete(breaks = NULL)
p3_1
```

